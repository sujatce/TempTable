SELECT MEMBER_MBI,
       GMPI_ID,
       ACTIVE_FLAG,
       INSERT_DATE,
       UPDATE_DATE
FROM DIM_MEMBER
WHERE MEMBER_MBI IN (
    SELECT MEMBER_MBI
    FROM DIM_MEMBER
    GROUP BY MEMBER_MBI
    HAVING COUNT(*) > 1
)
ORDER BY MEMBER_MBI, GMPI_ID;




SELECT 
    MEMBER_MBI,
    STRING_AGG(CAST(GMPI_ID AS NVARCHAR(50)), ', ') WITHIN GROUP (ORDER BY GMPI_ID) AS All_GMPI
FROM DIM_MEMBER
GROUP BY MEMBER_MBI
HAVING COUNT(*) > 1
ORDER BY MEMBER_MBI;


SELECT 
    d.MEMBER_MBI,
    d.GMPI_ID,
    x.cnt
FROM DIM_MEMBER d
JOIN (
    SELECT MEMBER_MBI, COUNT(*) AS cnt
    FROM DIM_MEMBER
    GROUP BY MEMBER_MBI
    HAVING COUNT(*) > 1
) x
    ON d.MEMBER_MBI = x.MEMBER_MBI
ORDER BY d.MEMBER_MBI, d.GMPI_ID;
