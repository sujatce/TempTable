SELECT
    mrm.GMPI_ID,
    mrm.MEMBER_LAST_NAME,
    mrm.MEMBER_FIRST_NAME,
    mrm.MBR_DATE_OF_BIRTH,
    mrm.MBR_GENDER,
    mrm.MEMBER_ID,
    dm.MEMBER_MBI,
    dma.MEMBER_PHONE AS MEMBER_PHONE,
    hmo.ELIGIBLE_FLAG AS ELIGIBILITY_FLAG,
    mrm.RISK_POOL_CODE,
    mrm.SRF_STATUS,
    mrm.PROVIDER_ID,
    CONCAT(dp.PROVIDER_FIRST_NAME, ' ', dp.PROVIDER_LAST_NAME) AS PROVIDER_FULL_NAME,
    dpa.CONTACT_PHONE AS PROVIDER_PHONE,
    dp.NPI_ID,
    CASE
        WHEN dc.CLINIC_RELATION = 'Affiliated' THEN 'Affiliated'
        WHEN mrm.OWNED_FLAG = 0 THEN 'Contracted'
        WHEN mrm.OWNED_FLAG = 1 THEN 'Owned'
        ELSE ''
    END AS PROVIDER_RELATION,
    mrm.CLINIC_ID,
    mrm.CLINIC_NAME,
    mrm.CLINIC_GROUP_ID,
    mrm.CLINIC_GROUP_NAME,
    mrm.REGION_ID,
    mrm.REGION,
    mrm.MARKET_ID,
    mrm.MARKET,
    CASE mrm.MBR_ELIG_INSURANCE_COMPANY_FULL_NAME
        WHEN 'United Community & State Texas' THEN 'UnitedHealthcare'
        WHEN 'United Facets Lite' THEN 'UnitedHealthcare'
        WHEN 'United of Florida' THEN 'UnitedHealthcare'
        WHEN 'United of Greater Texas' THEN 'UnitedHealthcare'
        WHEN 'United of Texas' THEN 'UnitedHealthcare'
        WHEN 'Cosmos United Lite' THEN 'UnitedHealthcare'
        ELSE mrm.MBR_ELIG_INSURANCE_COMPANY_FULL_NAME
    END AS MBR_ELIG_INSURANCE_COMPANY_FULL_NAME,
    mrm.MBR_ELIG_INSURANCE_COMPANY,
    mrm.MBR_ELIG_INSURANCE_COMPANY_ID,
    mrm.CONTRACT_ID,
    mrm.CONTRACT_PBP,
    mrm.BENEFIT_PLAN_DESCRIPTION,
    mrm.DATA_ENTITY,
    dm.MEMBER_LANGUAGE,
    'WELLMED' AS CDO,
    'WELLMED' AS BUSINESS_SEGMENT,
    mrm.REPORT_MONTH AS MRM_REPORT_MONTH
FROM FWRB_PRD_WMIDR_DB.BI_ANALYSIS.MEMBER_REPORT_MONTH AS mrm
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.DIM_PROVIDER AS dp
    ON mrm.PROVIDER_ID = dp.PROVIDER_ID
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.DIM_PROVIDER_ADDRESS AS dpa
    ON dp.PROVIDER_ID = dpa.PROVIDER_ID
   AND dpa.ACTIVE_FLAG = 1
   AND dpa.PROVIDER_ADDRESS_PRIMARY_FLAG = 1
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.DIM_CLINIC AS dc
    ON mrm.CLINIC_ID = dc.CLINIC_ID
   AND dc.ACTIVE_FLAG = 1
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.HIER_MEMBER_OPER AS hmo
    ON mrm.REPORT_MONTH = hmo.HIER_MONTH
   AND mrm.MEMBER_ID = hmo.MEMBER_ID
   AND mrm.GMPI_ID = hmo.GMPI_ID
   AND hmo.ACTIVE_FLAG = 1
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.DIM_MEMBER AS dm
    ON mrm.GMPI_ID = dm.GMPI_ID
LEFT JOIN FWRB_PRD_WMIDR_DB.BI_ANALYSIS.DIM_MEMBER_ADDRESS AS dma
    ON dma.MEMBER_ID = mrm.MEMBER_ID
   AND dma.ACTIVE_FLAG = 1
WHERE mrm.MEMBER_LAST_NAME IS NOT NULL
  AND mrm.MEMBER_FIRST_NAME IS NOT NULL
  AND mrm.MBR_DATE_OF_BIRTH IS NOT NULL
  AND mrm.MBR_GENDER IS NOT NULL
  AND dm.MEMBER_MBI IS NOT NULL
  AND mrm.REGION IN ('Florida', 'Greater Texas', 'Houston', 'North Texas')
  AND mrm.DATA_ENTITY = 'Wellmed'
  AND dm.MEMBER_LANGUAGE IN ('English', 'Spanish')
  AND mrm.REPORT_MONTH = (
        SELECT MAX(rm.REPORT_MONTH)
        FROM FWRB_PRD_WMIDR_DB.BI_ANALYSIS.MEMBER_REPORT_MONTH AS rm
        WHERE rm.DATA_ENTITY = 'Wellmed'
  )
  AND dp.PROVIDER_FIRST_NAME IS NOT NULL
  AND mrm.ACTIVE_FLAG = 1
  AND mrm.IS_HOSPICE_FLAG = 0
  AND mrm.LTI_FLAG = 0
  AND mrm.ESRD_FLAG = 0
  AND dm.ACTIVE_FLAG = 1
	AND mrm.CONTRACT_ID IN (
    'H0609', 'H1278', 'H2406', 'H4514', 'H4527', 'H5322', 'H4513',
    'H0062', 'H0174', 'H4506', 'H5294', 'H0028', 'H4461', 'H1045',
    'H1889', 'H2509', 'H5420', 'R0759', 'H1032', 'H1036', 'H5216',
    'H5427', 'H5594')
ORDER BY mrm.GMPI_ID;
